###############
# doc links: https://docs.github.com/zh/actions
#----------------------------------------------------------------

name: Solon Features Test
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€


on: [ push, pull_request, workflow_dispatch ]


jobs:
  env_init:
    name: Environment init
    env:
      PROJECT_NAME: solon
      STAGE: ENV_INIT
    runs-on: 'ubuntu-latest'
    steps:
      # check out code
      - name: Checkout code
        uses: actions/checkout@v3

  build_install_test:
    name: Build code and install and test
    needs: [ env_init ]
    env:
      STAGE: BUILD_INSTALL_TEST
    runs-on: 'ubuntu-latest'
    strategy:
      matrix:
        java: [ '8', '11', '17', '20' ]
    steps:
      - name: Setup java
        uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: ${{ matrix.java }}

      - name: Clean And Install
        run: |
          mvn clean install -Dmaven.test.skip=true --file pom.xml

      - name: Test Features
        run: |
          mvn test -Dtest="features.*" -Dmaven.test.failure.ignore=true -f __test/pom.xml

